# ExeclToJson
纯AHK编写的导表工具，支持复杂的excel结构，支持跨文件的主从引用，一键导出JSON，转JSON部分使用了飞跃大佬的JSON.ahk库
版本需要AHK1.1.37.01+,需要安装Excel(因为使用了COM对象)



### 主要功能：

* 支持自动识别表头所在行
* 支持导出boolean、null和时间戳数据类型
* 支持多层嵌套结构(可以在单元格内直接写入数组或者对象)
* 支持基于引用的主从结构，可以跨文件引用，也支持乱序引用(从表可以不在主表后面)，支持多级主从结构
* 支持无主键从表
* 支持主键重名检测和外键引用验证
* 支持主从表数据合并(可选)



### 表头类型

* `boolean`  布尔。
* `timestamp` 可以将格式化的日期导出为时间戳。
* `{}`  对象，同JS对象一致。
* `[]`  数组，同JS数组一致。
* `id` 主键类型，表中A列必须存在 `列名#id`单元格，作为识别表头位置的锚点，若不想定义主键值，将下方单元格置空即可。
* `owner` 外键类型，只存在于从表中。



### 表头规则

* 数据类型(string,number)不需要设置会自动判断，如果想导出字符串形式的纯数字，可以将数字括在双引号中，如 "123" 。
* 时间戳类型：`列名#timestamp` 。日期格式要符合标准日期格式。比如`YYYY/M/D H:m:s` or `YYYY/M/D` 等等。
* 布尔类型：命名形式 `列名#bool` 。
* 数组：命名形式  `列名#[]`，单元格内数组的书写方式与JS相同，若要表示字符串格式的纯数字或true、false、null，请将其括在双引号中，如"123"。
* 对象：命名形式 `列名#{}`，单元格内对象的书写方式与JS相同，若要表示字符串格式的纯数字或true、false、null，请将其括在双引号中，如"123"，"null"。。
* 主键：命名形式`列名#id` ,A列必须存在#id才会导出。
* 外键：命名形式`列名#owner`，表中只能有一列，只存在于从表中。
* 列名字以`!`开头则不导出此列。



### sheet规则

- sheet名字以`!`开头则不导出此表。
- 从表的名字 `从表名字@主表名字`，主表可以在同一批导出的excel文件的任何位置(可以与从表不在同一个文件)。



### 主从表相关规则(master/follower)

- 主表必须定义主键，主键在导出时进行重名检测，同一批次导出的excel文件共用一个重名检测列表，"0"不可以作为主键
- 从表在表名中通过@主表名来声明主从关系，主表名必须存在(主表名如果不存在，从表将不会被导出)
- 定义了主键的从表可以拥有自己的从表(多级引用)，但不可以循环引用
- 从表可以不定义主键，即便未定义主键，也应当保留#id列，否则无法定位标头行，未定义主键的从表数据不能再被引用
- 从表中定义的主键（#id）虽然与主表的主键值无关，但是仍然不允许其他表的主键值重复
- 从表中必须要有`#owner`列，从表每一行的数据必须定义外键（#owner）值，若从表中存在未定义外键的数据可能导致提前结束导出
- owner的值必须是(@主表名)中已存在的主键值（外键引用验证），若引用了不存在的主键，该条数据不会被导出
- 主表结束导出的标志是空主键单元格，从表结束导出的标志是空外键单元格


